<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<!-- saved from url=(0045)https://staff.aist.go.jp/yutaka.ueno/molskin/ -->
<html><head><meta http-equiv="Content-Type" content="text/html; charset=windows-1252">
		
		<title>Skeletal Animation for Molecular Models</title>
	</head>

	<body bgcolor="#ffffff">
		<h2>Skeletal Animation for Molecular Models</h2>

			Skeletal animation allows polygon models of the 3DCG object animate 
			by means of skeletal bones superimposed into the structure.			
			<p>

		</p><h3><br>
					Example1 -- Flexibility of hemoglobin molecule</h3>
					Conformational change is considered to allow oxgen binding process, as demonstrated in Wikipedia. Thermal fluctuation of hemoglobin molecule is yet to be explored.
					<br>

					<video src="/skelmol/1a00-0100-test.mp4" autostart="false" controls="">
					- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - <p>
					</p><p><i>... sorry, but this movie file needs html5 video</i></p>
					- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - <p>
					</p><hr>
					</video>
							
		 <br>	a sample motion file is made with our method on Blender. <br>
				<a href="/skelmol/data/era400-1a00.bvh">era400-1a00.bvh</a>  --- in BVH format
			<br>

		<h3><br>
					Example2 -- Myosin is a molecular motor to generate force in muscle.</h3>
					Its body may fluctuate when it is ready to make a force.
					Recent studies with atomic force microscopy is expected to reveal this motion.
					<br>
					
					<video src="/skelmol/1s5g-0100-test.mp4" autostart="false" controls="">
					- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - <p>
					</p><p><i>... sorry, but this movie file needs html5 video</i></p>
					- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - <p>
					</p><hr>
					</video>
			<br>
					 <br>	a sample motion file is made with our method on Blender.<br>
				<a href="/skelmol/data/ela400-1s5g.bvh">era400-1s5g.bvh</a>   --- in BVH format<br>

		<h4>We develop computer programs for molecular modeling</h4>
		<p>Programs are written in Lua, so download Lua interpreter from 
		www.lua.org or various repositories. They are experimental implementation
		that could be refined for a laboratory use, or embedding to the existing programs.
		They are developed and tested on Linux and Windows platforms, and most probably
		ok in MacOS.	



		
		</p><p> Following movies demonstrate how the models are animated.
			The method is described in a manuscript:
			"Skeletal animation for visualizing dynamic molecular shapes of macromolecules" by Yutaka Ueno, Shinya Muraoka and Tetsuo Sato.

			
		</p><h3><br>
			1. A normal mode superposition animation</h3>

					<video src="/skelmol/1amy0ela0.mp4" autostart="false" controls="">
					- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - <p>
					</p><p><i>... sorry, but this movie file needs html5 video</i></p>
					- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - <p>
					</p><hr>
					</video>

		<p> An animation of the thermal fluctuation of protein molecule is demonstrated. The motion of the atomic model is created from normal mode analysis at ProMode database for the protein data bank
			(PDB) atomic models. Then our method generates the skeletal bones to animate the molecular model in the format of BVH motion capture file. Using Blender the animation is generated. With the superposition
			of the normal mode waves gives a typical thermal fluctuation of the protein.  
		</p><h4>Source code files</h4>
		<p>	The program convert the simulation result output file into the motion
			capture file BVH. 
		</p><blockquote>
		 <br>
				<a href="/skelmol/src/ela2cpl3.lua">ela2cpl3.lua</a>  --- The conversion program<br>
				<a href="/skelmol/data/1amy-atme.tar.gz">1amy-atme.tar.gz</a>  --- a copy of the nomral mode analysis result from PDBelastic web site<br>
				The formal output file is on the PDBj site<br>
				https://pdbj.org/promode_data/am/1amy/1amy-results.tgz<br>
				
				<a href="/skelmol/data/ela3-1amy.bvh">ela3-1amy.bvh</a>  --- a sample output BVH file<br>
				<a href="/skelmol/data/ribbon-1amy-chimera.stl">ribbon-1amy-chimera.stl</a>  --- a ribbom model for 1AMY in STL format by UCSF Chimera<br>
				those files are requried to run the main program.<br>
				
				<a href="/skelmol/src/pdbmol.lua">pdbmol.lua</a>  --- PDB parser and molecular data list<br>
				<a href="/skelmol/src/mslmop.lua">mslmop.lua</a>  --- a module for matrix rotations<br>
				<a href="/skelmol/src/fit3p.lua">fit3p.lua</a>  --- module for matrix to fit 2 objects made by 3 nodes coordinates<br>

				<a href="/skelmol/blend279/md300-nmd1.blend">md300-nmd1.blend</a>  --- a sample blender script for this movie<br>	
				</blockquote>

		<h4>Usage</h4>
		<p>Among files from the normal mode calculation, only files with extension .flcatmE
		for all mode are used. Unpack these files in a directory 1amy-result/.
		There are parameters to modify amplitude or phase shift for combining each mode
		that could be defined in arrays: amplitude[] and phase[].

		</p>
				<h4>Descrioton</h4>
		<p>This program first make a list of group for protein residues
that is converted to the skeletal bones.
Then the generated groups have a skeleton bone whose
geometry is make by averaging atomic coordinates data
assigned in the group. Then the vector of the bone is also
calculated by the sequence of atoms in the group.

The calculation of the vector of the bone was modified
at empirical manner, so that the appearance of the final appearance
yield a reasonable direction for the given group.
Since the bone is used only for the visualization handle,
the precise definition is not needed. Small differences
in the bone geometry does not really make difference
in the final animated structure of this method.

Then the groups of residue in the PDB data is converted
to the BVH skeleton description. Here we take a flat structure
without a parent relationship between skeleton bone.
It is useful because the bones are not tightly connected
in ths grouping method for the protein. In case the all groups chains are connected as sequence of child bones,
calculation of atomic coordinates becomes complicated that
is not good approach.

The superposition of wave is applied in the function XYZadd()
that is saved into the data structure bonedata[].motion[]
The simple addition with variable amplitude and phase[] shift
value would also be specified.
The calculated oscillation vectors are applied to the
atomic coordinates, then the group are divided into three part
and these subgroup positions are used to calculate the
rigid translation matrix that most well describe the motion
of atoms in the group. Then the rotation matrix is converted into
Euler angles to save in the BVH file.


		</p><h4><br>
			2. A coarse-grained trajectory of a molecular dynamics simulation</h4>

					<video src="/skelmol/1amy0msk0.mp4" autostart="false" controls="">
					- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - <p>
					</p><p><i>... sorry, but this movie file needs html5 video</i></p>
					- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - <p>
					</p><hr>
					</video>					
		<p> A trajectory data of a molecular dynamics simulation was converted
			to a motion data set of the skeletal bones. Using the skeletal bones to modify 
molecular shape depicted in polygon mesh, various kind of the molecular
			models are able to animated. 
		</p><h4>Source code files</h4>
		<p>	The program convert the trajectory PDB file into the motion
			capture file BVH. 
		</p><blockquote>
		 <br>
				<a href="/skelmol/src/tpm2cpl3.lua">tpm2cpl3.lua</a>  --- The conversion program<br>
				<a href="/skelmol/data/1amy0_md300.pdb.gz">1amy0_md300.pdb.gz</a>  --- The trajectory file converted into multiple model PDB file<br>
				<a href="/skelmol/data/1amy-dssp.txt">1amy-dssp.txt</a>  ---DSSP result file for making bones, the secondary structre annotations for each residues<br>
				<a href="/skelmol/data/tpm-1amy.bvh">tpm-1amy.bvh</a>  --- Output BVH file<br>
				<a href="/skelmol/data/ribbon-1amy-traj1.stl">ribbon-1amy-traj1.stl</a>  --- a ribbom model for this trajectory conformation<br>
				the program also requires Lua functions that are loaded from files: pdbmol.lua mslmop.lua fit3p.lua <br>
				
				<a href="/skelmol/blend279/md300-tpm3.blend">md300-tpm3.blend</a>  --- a sample blender script for this movie<br>	
				</blockquote>
		
		<p></p>
		<h4>Usage</h4>
		<p>Following file names are set: TFILE for the trajectory file name, DFILE for the DSSP file, and BFILE for the output BVH file name. Groups are made with maximum residue length MAXLEN. 

		In a rare condition where the 3 atoms are located in a line, the matrix calculations to fit two conformation may fail. They can be avoided by 

		
		</p><h4><br>
			3. A reference trajectory by typical Molecular Dynamics</h4>

					<video src="/skelmol/1amy0grm0.mp4" autostart="false" controls="">
					- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - <p>
					</p><p><i>... sorry, but this movie file needs html5 video</i></p>
					- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - <p>
					</p><hr>
					</video>
		<p> An ordinary movie for a trajectory data of a molecular dynamics simulation.
			The movie was made by UCSF Chimera from GROMACS simulation. This fluctuation motion was used in the previous section, In this movie high frequency vibrational components are included that are not described in the normal mode motions.
		</p><h4>The simulation data files</h4>
		<p>	A typical molecular dynamics for a Brownian motion with explicit water
		molecules were followed according to the GROMACS documentation.
		</p><blockquote>
				<a href="/skelmol/src/donvt.sh">donvt.sh</a>  --- GROMACS a typical preparation for a MD simulation found in the official tutorial, <br>
				where nvt300.mdp and npt300.mdp are identical to the original tutorial.<br>
				<a href="/skelmol/data/md300f05.mdp">md300f05.mdp</a>  --- GROMACS input file for the production run. <br>
				  % gmx grompp -f md300f05.mdp -c 1amy0_npt300.gro -t 1amy0_npt300.cpt -p 1amy0.top -o 1amy0_md300.tpr <br>
				  % gmx mdrun -v -deffnm 1amy0_md300 -deffnm 1amy0_md300 <br>

				The result files are very large, and available at our institute URL.
				https://staff.aist.go.jp/yutaka.ueno/molskin <br>
				<a href="https://staff.aist.go.jp/yutaka.ueno/molskin/1amy0_md300.trr">1amy0_md300.trr</a>  --- 343MBytes, output trajectory file<br>
				<a href="https://staff.aist.go.jp/yutaka.ueno/molskin/1amy0_md300.tpr">1amy0_md300.tpr</a>  --- the corresponding topology file required to read the trajectory file<br>
				
				<br>		
		</blockquote>

		</p><h4><br>
<!--- pscdb fix 
			4. A demonstration of protein structural change on binding the ligand</h4>

					<video src="/skelmol/pscdb-481t72.mp4" autostart="false" controls="">
					- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - <p>
					</p><p><i>... sorry, but this movie file needs html5 video</i></p>
					- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - <p>
					</p><hr>
					</video>
		<p> An example of the structural change of Lysyl-tRNA synthetase based on PDB database 1BBU.
			Using the database for protein structural change collected from PDB protein structure database, 
			an animation for the structural change on ligand binding is demonstrated as a database code 
			entry code 481 in
			Protein Structural Change Database (PSCDB) developed at  <a href="https://idp1.force.cs.is.nagoya-u.ac.jp/pscdb/">https://idp1.force.cs.is.nagoya-u.ac.jp/pscdb/</a>


		</p><h4>The Data processing</h4>
		<p>	Two conformation of the protein are available from PDB. There are PDB files for the ligand free state and ligand bound state.
			These atomic coordinates are differently obtained from x-ray crystallography where these amino acid sequences are not always same
			because crystallography experiment may success only on one state from a certain species. Therefore, sequences are aligned
			to fit the atomic model of the proteins at different amino acid sequence.
			Let us focus on the ligand bound state of the protein, that will release the ligand and conformation will be changed
			that should fit to the ligand free state of the protein. While PSCDB provides morphing coordinates for the ligand free
			state, we here obtained that for ligand bound state. Therefore, we renumber the sequence of PDBs for the morphing and ligand free stats that meet to the
			ligand bound state. Among 50 morpihng models
			calculated on the server, files for models at indices 1,10,20,30,40,49 was used. The chain names are renamed as A and B for the biological unit, 
			and L for the ligand molecules.
		</p><blockquote>
				<a href="/skelmol/src/mofpsc2.lua">mofpsc2.lua</a>  --- fix residue numbers for the morphing motion results <br>

				<a href="/skelmol/data/pb0481m.zip">pb0481m.zip</a>  --- converted PDB files<br>

				<a href="/skelmol/src/propdb2bvh7e7.lua">propdb2bvh7e7.lua</a>  --- make a BVH file from the sequence of PDB files <br>
				<br>
				<a href="/skelmol/data/pr7e7-1bbu.bvh">pr7e7-1bbu.bvh</a>  --- generated BVH file<br>

				<a href="/skelmol/blend279/pscdb-481-t72.zip">pscdb-481-t72.blend</a>  --- a sample blender script for this movie (zip compressed)<br>	
				
				<br>		
		</blockquote>
 pscdb fix --->


<!--- --->

<h3>Related developments </h3>
<p>We are studying the animation method using Blender for molecular biology. Some of the examples are provided from our site.
                  <a href="https://uenoyt.github.io/blendmb" target="_blank">Blender fo Molecular Biology</a>

</p><p>
Questions and comments are welcome to yutaka.ueno@aist.go.jp
</p><hr>
2022 Sep,26 Yutaka Ueno, AIST
</body></html>

